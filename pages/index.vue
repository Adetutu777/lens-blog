<template>
<div class="mt-4">
 


<div class="homepage">
    <nav>
        <div class="navbar">
            <h4 class="logo">
                <span>story</span>tribe
            </h4>


            <div class="search-bar">
                <i class="uil uil-search"></i>
                <input type="search" placeholder="Find your favourite blogs">
            </div>

            <a class="profile">
                <div class="profile-photo">
                    <img src="@/images/Ellipse 43.png" alt="pix 1">
                </div>
                <div class="handle">
                    <h4>Miss Asake</h4>
                    <p class="text-muted">@nkem_asake.lens</p>
                </div>
            </a>

        </div>
    </nav>

    <!----------hero section--------->
    <div class="hero">
        <div class="hero-container">
            <!----------left--------->
            <div class="left">
                <div class="sidebar">
                    <a class="menu-item active">
                        <span><i class="uil uil-estate"></i></span>
                        <h3>Home</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-bookmark"></i></span>
                        <h3>Saved</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-envelope-add"></i></span>
                        <h3>Notifications</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-setting"></i></span>
                        <h3>Settings</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-user-circle"></i></span>
                        <h3>Profile</h3>
                    </a>

                    <a class="menu-item">
                        <span><i class="uil uil-question-circle"></i></span>
                        <h3>Help</h3>
                    </a>

                    <label for="create-post" class="btn btn-primary" id="post">Write</label>
                </div>

            </div>

            <!----------middle--------->
            <div class="middle">
                <!-------------- middle header ---------------->
                <div class="post">
                    <a class="new active">
                        <span><i class="uil uil-award-alt"></i></span>
                        <h3>New</h3>
                    </a>
                    <a class="new">
                        <span><i class="uil uil-panel-add"></i></span>
                        <h3>Top</h3>
                    </a>
                    <a class="new">
                        <span><i class="uil uil-clock"></i></span>
                        <h3>History</h3>
                    </a>
                </div>

                <!-------------- feeds --------------->
                <div class="feeds">
                    <!------- feed 1 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/Ellipse 44.png">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 26, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>Being among the top 1% is not as easy as it seems</h3>
                            <a href="read.html"><img src="@/images/Frame 1.png"></a>
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 2 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-14.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>The concert that shook a lot of relationships</h3>
                            <img src="@/images/Frame 2.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 3 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-15.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>Nigeria is not a democratic state, here's why.</h3>
                            <img src="@/images/Frame 3.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 4 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-16.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>Top 10 ways to make money during this times</h3>
                            <img src="@/images/Frame 4.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 5 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-17.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>FIFA World Cup predictions</h3>
                            <img src="@/images/Frame 5.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 6 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-18.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>D-ALLE vs Mid-journey which is better</h3>
                            <img src="@/images/Frame 6.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>

                    <!------- feed 7 ------->
                    <div class="feed">
                        <div class="head">
                            <div class="user">
                                <div class="profile-photo">
                                    <img src="@/images/profile-19.jpg">
                                </div>
                                <div class="info">
                                    <h3>Esco Funds</h3>
                                    <small>@esco_funds.lens  .  Nov 12, 2022</small>

                                </div>
                            </div>
                            <span class="edit">
                                <i class="uil uil-book-open"></i> 2mins read
                            </span>
                        </div>
                        <div class="photo">
                            <h3>Being among the top 1% is not as easy as it seems</h3>
                            <img src="@/images/Frame 7.png">
                        </div>

                        <div class="action-button">
                            <div class="interaction-button">
                                <span><i class="uil uil-bookmark"></i></span>
                                <h5>Money</h5>
                                <h5>Business</h5>
                                <h5>Dogecoin</h5>
                            </div>
                            <div class="bookmark">
                                <span><i class="uil uil-heart"></i></span>
                                <h5>24k</h5>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <!----------right--------->
            <div class="right">
                <div class="messages">
                    <div class="heading">
                        <h4>Trending Topics</h4>
                    </div>

                    <div class="category">
                        <p class="details">Chivalry is dead</p>
                        <p class="details">How to prepare for WW3</p>
                        <p class="details">Rema's concert</p>
                        <p class="details">Nick Minaj</p>
                        <p class="details">Peter Obi</p>
                        <p class="details">World Cup</p>
                    </div>
                    <label for="create-post" class="btn btn-primary" id="post">Show more</label>
                </div>
            </div>
        </div>
    </div>


</div>

</div>
</template>



<script>
import { onMounted, ref, computed, watchEffect, reactive} from '@nuxtjs/composition-api';
import {client, recommendProfiles, clientId, publicationsQuery} from '../api'
import "../main.css"

    export default {
        setup(){
          const loading = ref(true)
          const ethWindowObj = ref('')
          const signerOrProvider = ref('')
          const isConnected = ref(false)
          const userAddress = ref('')
          const getProfiles = reactive({
            data:{

            }
          })

     const fetchProfiles = async() =>{
              try {
                const resp = await client.query(recommendProfiles).toPromise()
              const mappedData = resp?.data?.recommendedProfiles.map((i)=>{
                const CID = i.picture?.original?.url
                const getCid = CID ? CID.split('').slice(7).join('') : 'bafkreigfkue3cdeve7pa23vvsmp2lcmj32flksdvlrllt44gpl25bqhp6m'
                return {...i, 
                url: CID?.length === 66 ? 'https://ipfs.io/ipfs/'+ getCid : !CID?.length ?  'https://ipfs.io/ipfs/bafkreigfkue3cdeve7pa23vvsmp2lcmj32flksdvlrllt44gpl25bqhp6m' : CID
                // url:'https://ipfs.io/ipfs/'+ getCid
                } 
              })
            
              getProfiles.data = mappedData ?? getProfiles.data
              } catch (error) {
                console.log(error)
              }finally {
                loading.value = false
                }
              
            }


            watchEffect(() => {
               fetchProfiles()
        }, [])

        

        onMounted(()=>{
        signerOrProvider.value = window.ethereum
        userQuery()
        })

             // function to connect to MetaMask
      const onClickConnect = async () => {
        try {
            // Will open the MetaMask UI
            const account = await signerOrProvider.value.send("eth_requestAccounts", []);
            isConnected.value = true;
            userAddress.value = account[0];
        } catch (error) {
            console.error(error);
            console.log(error.message)
        }
    }

      const userQuery =async()=>{
            try {
              const getProfilesId = await clientId.request(recommendProfiles)
              const ids= getProfilesId.recommendedProfiles.map((i)=> i.id)
                 const publicationsPost = await clientId.request( publicationsQuery, {ids} )
                 console.log('omoKehindeGbegbon', publicationsPost)
            } catch (error) {
                 console.log('error', error)
            }
        }
          return{loading, getProfiles, onClickConnect , isConnected, userAddress}
        }
    }
</script>

<style scoped>

</style>
